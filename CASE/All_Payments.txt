SELECT 
	ACCOUNT_NO, 
	TO_CHAR(TRANS_DATE,'yyyy-MM-dd') AS TRANS_DATE, 
	TO_CHAR(POST_DATE,'yyyy-MM-dd') AS POST_DATE, 
	B.TRANS_SOURCE, 
	TSV.DISPLAY_VALUE AS PAY_SOURCE, 
	B.BMF_TRANS_TYPE,
	B.TRANS_SUBMITTER,
	DESCRIPTION_TEXT, 
	(TRANS_AMOUNT/100) AS PAYMENTS,
	B.ANNOTATION,
	BILL_REF_NO, 
	CASE WHEN ACTION_CODE = 'APP' THEN 'APPLIED'
         WHEN ACTION_CODE = 'DEL' THEN 'VOID'
         WHEN ACTION_CODE = 'REV' THEN 'REVERSE'
   END C1_STATUS,
   EXTERNAL_CURRENCY as currency_code
FROM BMF_EXTRACT B
	LEFT JOIN TRANS_SOURCE_VALUES TSV
	ON B.TRANS_SOURCE = TSV.TRANS_SOURCE
	LEFT JOIN BMF_TRANS_DESCR BTD
	ON B.BMF_TRANS_TYPE = BTD.BMF_TRANS_TYPE
	LEFT JOIN DESCRIPTIONS DS
	ON BTD.DESCRIPTION_CODE = DS.DESCRIPTION_CODE
WHERE DATE(EXTRACT_FILE_DATE) =  '20200503'::date  
AND DATE(B.POST_DATE) between '20200401'::date and '20200430'::date
AND B.NO_BILL = 0 
AND B.TRANS_AMOUNT/100 > 2 AND B.BMF_TRANS_TYPE NOT IN(16,33,51,52,53,80,90)
ORDER BY 1,2