SELECT 'PRE-MOB MTR REVENUE ' || TO_CHAR(DATE_TRUNC('MONTH',CURRENT_DATE - DAY(CURRENT_DATE)),'MON_YYYY') AS DESCRIPTION,
       CASE WHEN SUBSTRING(MT.MTR_COMMENT,1,9) IN ('DSP data ','DPS data ') THEN 'Data Plan Subscription'
             WHEN SUBSTRING(MT.MTR_COMMENT,1,9) = 'FA2 Subsc' THEN 'After 2 Opt-in '
             WHEN SUBSTRING(MT.MTR_COMMENT,1,9) = 'Smarttalk' THEN 'Smart Talk Subscription'
             ELSE 'Balance Transfers' END ACTIVITY_TYPE,
       COUNT(1) AS NUMBER_TRANS,
       SUM(MB.AMOUNT/100)/1.14 AS REVENUE,
       SUM((MB.AMOUNT/100) - ((MB.AMOUNT/100)/1.14)) AS TAX_AMOUNT
FROM MTR MT
       JOIN MTR_BALANCE MB
       ON MT.MTR_ID = MB.MTR_ID AND MT.MTR_ID2 = MB.MTR_ID2 AND MB.PAYMENT_MODE = 1
WHERE DATE(MT.MOD_DATE) BETWEEN DATE_TRUNC('MONTH',CURRENT_DATE - DAY(CURRENT_DATE)) AND DATE(CURRENT_DATE-DAY(CURRENT_DATE))
AND ((MT.LOGIN_NAME = 'gttsapi' AND SUBSTRING(MT.MTR_COMMENT,1,9) IN ('DSP data ','DPS data ','FA2 Subsc','Smarttalk'))
OR (MT.LOGIN_NAME = 'ussd' 