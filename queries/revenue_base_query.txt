--DATA Subscriptions / Revenue
SELECT 
       TO_CHAR(A.APPLY_DATE, 'YYYY-MM-DD') AS Apply_dt,
       B.OFFER_ID, 
       D.DISPLAY_VALUE AS OFFER_DESCRIPTION, 
       COUNT(1) AS COUNT,
       COUNT(DISTINCT A.PARENT_SUBSCR_NO) AS Subs,
       SUM(a.AMOUNT)/100 AS REVENUE_PREPAID, 
       SUM(a.TOTAL_TAX)/100 AS TAX_PREPAID
FROM RC A
       LEFT JOIN OFFER_REF B
       ON A.OFFER_ID = B.OFFER_ID AND B.RESELLER_VERSION_ID = (SELECT MAX(reseller_version_id) FROM reseller_version)
       JOIN RC_BALANCE C
       ON A.RC_TERM_INST_ID = C.RC_TERM_INST_ID AND A.BILLING_SEQUENCE_NUMBER = C.BILLING_SEQUENCE_NUMBER AND C.PAYMENT_MODE = 1
       LEFT JOIN OFFER_VALUES D
       ON A.OFFER_ID = D.OFFER_ID AND D.RESELLER_VERSION_ID = (SELECT MAX(RESELLER_VERSION_ID) FROM OFFER_VALUES)
WHERE B.SERVICE_CATEGORY_ID=4 AND B.PAYMENT_MODE=1 AND C.BALANCE_ID = 89 and A.RC_TERM_ID IN (1766,1864,1886) --comment this if you want all
AND DATE(A.APPLY_DATE) BETWEEN ${begin_dt} AND ${end_dt}
--AND A.AMOUNT != 0
GROUP BY 1,2,3
ORDER BY 1,2
