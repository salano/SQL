SELECT 

score.ACCOUNTNUMBER,
score.BID,
sum(score.NET_DEACTIVATIONS) AS CHURN
FROM 
(
SELECT
		distinct
		a.DATESTART ,
		ifNULL(b.DATEOUT, a.DATESTART) AS DEACT_DATE,
		a.BID,
		a.ACCOUNTNUMBER, 
		a.BEGINNING_ACTIVE,
		a.NET_ACTIVATIONS,
		a.NET_DEACTIVATIONS,
		a.ENDING_ACTIVE 
		FROM
		ATNI_PROD.ATNI_ANALYTICS.SUBSCRIBER_BG_END_WEEKLY_MONTHLY_SNAPSHOT_DAILYACTIVITY a 
		 LEFT JOIN ATNI_PROD.SC_INPUT.ODSSUBSCRIBERSNAPSHOT b 
		 	ON a.DATESTART = b.DATESTART AND a.ACCOUNTNUMBER = b.ACCOUNTNUMBER  AND a.BID = b.BID AND b.SOURCESYSTEMID=1
		WHERE
		a.SOURCESYSTEMID=1
		AND SUBLINE_OF_SERVICE IN ('Mobile Prepaid')
		AND a.UNIT_COUNTABLE=1
		AND a.REVENUE_COUNTABLE=1
		AND a.DATASET_TYPE IN('BG_MONTHLY_SNAPSHOT', 'END_MONTHLY_SNAPSHOT', 'DAILY_SUB_ACTIVITY')
		--AND date(a.DATESTART) BETWEEN to_date('2021-01-01','YYYY-MM-DD') AND to_date('2021-12-31','YYYY-MM-DD')
				
) score
WHERE date(score.DEACT_DATE)  >= ADD_MONTHS(current_date, -3)
GROUP BY 1,2
Order BY 1,2