SELECT 
distinct
 c.ACCOUNT_NO
 ,c.BILL_FNAME
 ,c.BILL_LNAME
  ,concat(nvl(c.BILL_ADDRESS1,''),' ',nvl(c.BILL_ADDRESS2,''),' ' ,nvl(c.BILL_ADDRESS3,''),' ',nvl(c.BILL_ADDRESS4,''),' ',nvl(c.BILL_CITY,'')) Address
  ,CONCAT('592',dsl.PHONE_NUMBER) PHONE_NUMBER
  ,nvl(c.CUST_EMAIL,c.STATEMENT_TO_EMAIL) EMAIL
  ,DSL.SERVICE_NAME AS SERVICE_PLAN
  ,AMS.IMEI AS SERIAL_NUMBER
FROM
ATNI_PROD.GTT_REPORTING.CMF_EXTRACT c join
 ATNI_PROD.GTT_REPORTING.EXTERNAL_ID_EQUIP_MAP_EXTRACT eip on c.ACCOUNT_NO = eip.ACCOUNT_NO and date(c.EXTRACT_FILE_DATE) = date(current_date)
LEFT JOIN ATNI_PROD.GTT_REPORTING.DSL_DUMPS_DNS_RAW DSL 
	ON eip.EXTERNAL_ID = CONCAT('592',dsl.PHONE_NUMBER) AND date(dsl.dump_ts) = date(CURRENT_DATE())
LEFT JOIN 
	GTT_REPORTING.ALL_MMS_SALES AMS
	ON c.ACCOUNT_NO = AMS.CLI_NUMBER AND ams.prd_type IN ('M1','M2') AND ams.VOID_STATUS='N'
 where
  eip.IS_CURRENT = 1 and 
  date(eip.EXTRACT_FILE_DATE) = date(current_date) AND
  eip.EXTERNAL_ID_TYPE in (11) AND 

  (c.BILL_FNAME IS NOT NULL AND c.BILL_FNAME IS not NULL) 