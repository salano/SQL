SELECT 
	  		DISTINCT 
	  		C.BILL_FNAME ,
			C.BILL_LNAME ,
			C.BILL_COMPANY ,
			C.BILL_ADDRESS1 ,
			C.BILL_ADDRESS2 ,
			C.BILL_ADDRESS3 ,
			C.BILL_ADDRESS4 ,
			C.BILL_CITY ,
	  		tmp.ACCOUNT_NO,
	  		tmp.EXTERNAL_ID,
	  		ins.SUBSCR_NO,
	  		ins.OFFER_ID,
	  		O.DISPLAY_VALUE current_service,
	  		min(ins.ACTIVE_DT) OVER 
	  			(PARTITION BY ins.ACCOUNT_NO, ins.SUBSCR_NO,ins.OFFER_ID ORDER BY ins.ACTIVE_DT DESC 
	  			RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
	  			) AS activate_date

	  FROM 
	     ATNI_DEV.GTT_REPORTING.JUNE_PROMOTERS_TMP tmp 
	   LEFT JOIN ATNI_PROD.GTT_REPORTING.OFFER_INST ins
	  	  ON ins.ACCOUNT_NO = tmp.ACCOUNT_NO 
	  	 JOIN ATNI_PROD.GTT_REPORTING.CMF_EXTRACT  C
		       ON ins.ACCOUNT_NO = C.ACCOUNT_NO  AND date(C.EXTRACT_FILE_DATE) = date(CURRENT_DATE())
		JOIN
					ATNI_PROD.GTT_REPORTING.OFFER_VALUES O ON ins.OFFER_ID=O.OFFER_ID AND RESELLER_VERSION_ID IN(SELECT MAX(RESELLER_VERSION_ID) FROM ATNI_PROD.GTT_REPORTING.OFFER_VALUES)
	 WHERE 
	 	--date(ins.ACTIVE_DT)   >= to_date('2022-01-01','YYYY-MM-dd') 
	 	--AND ins.OFFER_ID in(11167,11114,11115,11469,11470,11186)
	    ins.offer_type = 2
	    AND ins.INACTIVE_DT IS null
	 	AND tmp.ACCOUNT_NO <> '0'
	 	AND C.DATE_INACTIVE IS null
	 	--AND O.DISPLAY_VALUE NOT LIKE '%Plus%'
order BY 1,2