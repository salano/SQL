SELECT
    USR.ID,
    USR.USERNAME,
    DET.ACCOUNT_NUMBER,
    USR.CREATED_AT,
    USR.LAST_LOGIN_AT,
    USR.UPDATED_AT,
    C.BILL_FNAME,C.BILL_LNAME, C.BILL_COMPANY,
    CASE
     WHEN E.EXTERNAL_ID_TYPE = 9 THEN 'Landline'
       WHEN E.EXTERNAL_ID_TYPE = 11 THEN 'DSL'
         WHEN E.EXTERNAL_ID_TYPE = 1 THEN 'Mobile'
         WHEN E.EXTERNAL_ID_TYPE = 27 THEN 'Leased Line'
       WHEN E.EXTERNAL_ID_TYPE in (37,39) THEN 'Blaze'
       ELSE 'Unknown'
  END SERVICE,
    TO_CHAR(TRANS_DATE,'yyyy-MM-dd') AS TRANS_DATE, 
	TO_CHAR(POST_DATE,'yyyy-MM-dd') AS POST_DATE, 
    (TRANS_AMOUNT/100) AMOUNT,
    
    CASE WHEN ACTION_CODE = 'APP' THEN 'APPLIED'
         WHEN ACTION_CODE = 'DEL' THEN 'VOID'
         WHEN ACTION_CODE = 'REV' THEN 'REVERSE'
   END C1_STATUS,
    bmf.ANNOTATION ,
    bmf.TRANS_SUBMITTER ,
    DESCRIPTION_TEXT,
    acv.DISPLAY_VALUE acct_type
FROM 
	BMF_EXTRACT bmf
	LEFT JOIN MY_ACCOUNT_USER_ACCOUNTS DET 
		ON bmf.ACCOUNT_NO = DET.ACCOUNT_NUMBER AND date(bmf.EXTRACT_FILE_DATE) = current_date 	
	LEFT JOIN MY_ACCOUNT_USERS USR
	ON DET.USER_ID=USR.ID
	LEFT JOIN GTT_REPORTING.CMF_EXTRACT C
	ON bmf.ACCOUNT_NO = C.ACCOUNT_NO  AND date(c.EXTRACT_FILE_DATE) = current_date 	
	LEFT JOIN GTT_REPORTING.EXTERNAL_ID_EQUIP_MAP_EXTRACT E
	ON bmf.SUBSCR_NO = E.SUBSCR_NO AND date(e.EXTRACT_FILE_DATE) = current_date 	
	LEFT JOIN BMF_TRANS_DESCR BTD
	ON BMF.BMF_TRANS_TYPE = BTD.BMF_TRANS_TYPE
	LEFT JOIN DESCRIPTIONS DS
	ON BTD.DESCRIPTION_CODE = DS.DESCRIPTION_CODE
	LEFT JOIN 
		ATNI_PROD.GTT_REPORTING.ACCOUNT_CATEGORY_VALUES acv on c.account_category = acv.account_category and acv.SERVICE_VERSION_ID = (select max(SERVICE_VERSION_ID) from ATNI_PROD.GTT_REPORTING.ACCOUNT_CATEGORY_VALUES)
WHERE 
	upper(TRANS_SUBMITTER) LIKE '%MYGTT%'
 	AND  date(TRANS_DATE) = CURRENT_DATE-1  -- CURRENT_DATE - DAY(CURRENT_DATE)+1 AND CURRENT_DATE-1
 	AND BMF.BMF_TRANS_TYPE NOT IN (16,33,51,52,53,80,90)