SELECT 
  		DISTINCT 
  		ins.ACTIVE_DT activate_date,
  		C.BILL_FNAME ,
		C.BILL_LNAME ,
		C.BILL_COMPANY ,
		C.BILL_ADDRESS1 ,
		C.BILL_ADDRESS2 ,
		C.BILL_ADDRESS3 ,
		C.BILL_ADDRESS4 ,
		C.BILL_CITY ,
  		ins.ACCOUNT_NO,
  		ins.SUBSCR_NO,
  		S.INACTIVE_DT,
  		acv.DISPLAY_VALUE account_type,
  		SRV.DISPLAY_VALUE ACCOUNT_STATUS,
  		listagg( DISTINCT O.DISPLAY_VALUE, ', ') offer_list
  FROM 
  	(SELECT distinct offer_id, ACCOUNT_NO, SUBSCR_NO,disconnect_reason, ACTIVE_DT FROM  ATNI_PROD.GTT_REPORTING.OFFER_INST WHERE  offer_id IN (
										SELECT
										try_TO_NUMERIC(REPLACE(PRODUCTCODE,'MP',''))
										FROM
										ATNI_PROD.SC_OUTPUT.DIMPRODUCT
										WHERE
										LEAFLEVELNAME='Internet'
										AND SOURCESYSTEMID=1
										AND PRODUCTCODE LIKE 'MP%'
									)  )   ins
  
  
  	LEFT JOIN ATNI_PROD.GTT_REPORTING.SUBSCRIBER_STATUS_EXTRACT S
  		ON ins.SUBSCR_NO = S.SUBSCR_NO  AND date(S.EXTRACT_FILE_DATE) = date(CURRENT_DATE()) AND S.INACTIVE_DT IS null
  	LEFT JOIN ATNI_PROD.GTT_REPORTING.CMF_EXTRACT  C
	       ON ins.ACCOUNT_NO = C.ACCOUNT_NO  AND date(C.EXTRACT_FILE_DATE) = date(CURRENT_DATE())
	JOIN
		ATNI_PROD.GTT_REPORTING.OFFER_VALUES O ON ins.OFFER_ID=O.OFFER_ID AND RESELLER_VERSION_ID IN(SELECT MAX(RESELLER_VERSION_ID) FROM ATNI_PROD.GTT_REPORTING.OFFER_VALUES)
	join 
		ATNI_PROD.GTT_REPORTING.ACCOUNT_CATEGORY_VALUES acv on c.account_category = acv.account_category and acv.SERVICE_VERSION_ID = (select max(SERVICE_VERSION_ID) from ATNI_PROD.GTT_REPORTING.ACCOUNT_CATEGORY_VALUES)
	JOIN ATNI_DEV.GTT_REPORTING.STATUS_VALUES SRV
	   		ON S.STATUS_ID = SRV.STATUS_ID 
 WHERE 
 	--date(ins.ACTIVE_DT)   BETWEEN to_date('2022-01-01','YYYY-MM-dd') AND to_date('2022-03-31','YYYY-MM-dd')
 	--AND ins.OFFER_ID in(11167,11114,11115,11469,11470,11186)
 	ins.ACCOUNT_NO <> '0'
 GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14
 
 
 SELECT * FROM ATNI_DEV.GTT_REPORTING.STATUS_VALUES  LIMIT 10;