select 
   C.BILL_FNAME || ' '||C.BILL_LNAME ||' '|| C.BILL_COMPANY FullName,
   C.CONTACT2_PHONE||' ' ||C.CONTACT2_PHONE CONTACT_NO,
   C.CUST_EMAIL,
   C.BILL_ADDRESS1 ||' '|| C.BILL_ADDRESS2 ||' '||  C.BILL_ADDRESS3 ||' '||  C.BILL_ADDRESS4 ADDRESS,
  SC.SERVICE_ORDER_ID,
  SC.ORDER_ID,
  SC.CREATE_DT,
  SC.COMPLETE_DT,
  SC.ACCOUNT_NO,
  SC.SUBSCR_NO,
  SC.PRIMARY_OFFER_ID,
  OV.DISPLAY_VALUE,
  AC.DATE_ENTER_ACTIVE AS ACTIVE_DATE,
  BI.INITAL_BILL,
  SUM(CB.BALANCE_DUE) as TOTAL_DUE
  
from 
  ORD_SERVICE_ORDER SC
  LEFT JOIN CMF C ON SC.ACCOUNT_NO = C.ACCOUNT_NO
  left JOIN
    account_subscriber@read_main1 AC on SC.SUBSCR_NO = AC.SUBSCR_NO and SC.ACCOUNT_NO = AC.ACCOUNT_NO
  LEFT JOIN OFFER_VALUES OV ON SC.PRIMARY_OFFER_ID = OV.OFFER_ID
  LEFT JOIN  
    (select
        ACCOUNT_NO,
        MIN(STATEMENT_DATE) as INITAL_BILL
  from 
    BILL_INVOICE
  where 
    PREP_STATUS =1 and
    PREP_ERROR_CODE is null AND
    BACKOUT_STATUS = 0 and
    TRUNC(STATEMENT_DATE)>= to_date('01-JAN-2020','DD-MON-YYYY')
  Group by 
    ACCOUNT_NO) BI on SC.ACCOUNT_NO = BI.ACCOUNT_NO
    
    
  LEFT JOIN CMF_BALANCE CB on SC.ACCOUNT_NO = CB.ACCOUNT_NO
WHERE
  SC.ORDER_STATUS_ID=80 AND
  SC.SERVICE_ORDER_TYPE_ID =10 AND
  SC.IS_SERVICE_LEVEL=1 AND
  SC.WP_PROCESS_ID='DSLC' AND 
  trunc(SC.complete_dt) >=to_date('01-JAN-2020','DD-MON-YYYY') AND
  OV.RESELLER_VERSION_ID IN (SELECT MAX(RESELLER_VERSION_ID) FROM OFFER_VALUES)


     


GROUP BY

   C.BILL_FNAME || ' '||C.BILL_LNAME ||' '|| C.BILL_COMPANY,
   C.CONTACT2_PHONE||' ' ||C.CONTACT2_PHONE ,
   C.CUST_EMAIL,
   C.BILL_ADDRESS1 ||' '|| C.BILL_ADDRESS2 ||' '||  C.BILL_ADDRESS3 ||' '||  C.BILL_ADDRESS4,
  SC.SERVICE_ORDER_ID,
  SC.ORDER_ID,
  SC.CREATE_DT,
  SC.COMPLETE_DT,
  SC.ACCOUNT_NO,
  SC.SUBSCR_NO,
  SC.PRIMARY_OFFER_ID,
  OV.DISPLAY_VALUE,
  AC.DATE_ENTER_ACTIVE,
  BI.INITAL_BILL

order by
   C.BILL_FNAME || ' '||C.BILL_LNAME ||' '|| C.BILL_COMPANY
