    SELECT 
      TO_CHAR(TRANS_DATE,'yyyy') AS TRANS_YEAR, 
      TSV.DISPLAY_VALUE AS PAY_SOURCE, 
      DESCRIPTION_TEXT, 
      CASE WHEN ACTION_CODE = 'APP' THEN 'APPLIED'
         WHEN ACTION_CODE = 'DEL' THEN 'VOID'
         WHEN ACTION_CODE = 'REV' THEN 'REVERSE'
   END C1_STATUS,
   sum(TRANS_AMOUNT/100) AS PAYMENTS,
   count(1) Num_TRANS

FROM GTT_REPORTING.BMF_EXTRACT B
      LEFT JOIN GTT_REPORTING.TRANS_SOURCE_VALUES TSV
      ON B.TRANS_SOURCE = TSV.TRANS_SOURCE
      LEFT JOIN GTT_REPORTING.BMF_TRANS_DESCR BTD
      ON B.BMF_TRANS_TYPE = BTD.BMF_TRANS_TYPE
      LEFT JOIN GTT_REPORTING.DESCRIPTIONS DS
      ON BTD.DESCRIPTION_CODE = DS.DESCRIPTION_CODE
WHERE DATE(B.EXTRACT_FILE_DATE) =  date(current_date)
AND DATE(B.TRANS_DATE) > dateadd(year, -5, date_trunc('YEAR', current_date))
--AND B.NO_BILL = 0 
AND B.TRANS_AMOUNT/100 > 2 AND B.BMF_TRANS_TYPE NOT IN(16,33,51,52,53,80,90)
GROUP BY 1,2,3,4
ORDER BY 1,2
