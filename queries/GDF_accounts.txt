SELECT 
c.ACCOUNT_NO,
  eip.EXTERNAL_ID AS Phone,
  BILL_FNAME, 
  BILL_LNAME, 
  BILL_COMPANY,
  C.DATE_ACTIVE,
  to_char(C.DATE_ACTIVE, 'YYYY-MM') as ACTIVE_YYYY_MM,
  c.DATE_INACTIVE,
  --A.ACTIVE_DT OFFER_ACTIVE_DT,
  --OV.DISPLAY_VALUE AS Description,
  --round(RRC.RATE/100) AS RATE ,
  BILL_ADDRESS1 ||' ' ||BILL_ADDRESS2 ||' '|| BILL_ADDRESS3||' ' || BILL_ADDRESS4||' ' || BILL_STATE||' ' || BILL_ZIP|| ' ' || BILL_COUNTY Address,
  BILL_CITY,
  CUST_EMAIL Email,
  --c.statement_to_email,
  CUST_PHONE1 ||' '  ||CUST_PHONE2 CustPhone,
  CONTACT1_PHONE||' ' ||CONTACT2_PHONE ContactPhone,
  acv.DISPLAY_VALUE cust_type,
  eiv.DISPLAY_VALUE,
  CASE
     WHEN eip.EXTERNAL_ID_TYPE = 9 THEN 'Landline'
       WHEN eip.EXTERNAL_ID_TYPE = 11 THEN 'DSL'
         WHEN eip.EXTERNAL_ID_TYPE = 1 THEN 'Mobile'
         WHEN eip.EXTERNAL_ID_TYPE = 27 THEN 'Leased Line'
       WHEN eip.EXTERNAL_ID_TYPE in (37,39) THEN 'Blaze'
       ELSE 'Unknown'
  END SERVICE

FROM GTT_REPORTING.CMF_EXTRACT  c
LEFT JOIN
	ATNI_PROD.GTT_REPORTING.EXTERNAL_ID_EQUIP_MAP_EXTRACT eip on c.ACCOUNT_NO = eip.ACCOUNT_NO AND date(eip.EXTRACT_FILE_DATE) = date(CURRENT_DATE())
LEFT join
  	ATNI_PROD.GTT_REPORTING.ACCOUNT_CATEGORY_VALUES acv on c.account_category = acv.account_category and acv.SERVICE_VERSION_ID = (select max(SERVICE_VERSION_ID) from ATNI_PROD.GTT_REPORTING.ACCOUNT_CATEGORY_VALUES) AND date(acv.EXTRACT_FILE_DATE) = date(CURRENT_DATE())
LEFT JOIN 
	
  ATNI_PROD.GTT_REPORTING.EXTERNAL_ID_TYPE_VALUES eiv on eip.EXTERNAL_ID_TYPE = eiv.EXTERNAL_ID_TYPE and eiv.service_version_id = (select max(service_version_id) from ATNI_PROD.GTT_REPORTING.EXTERNAL_ID_TYPE_VALUES)
WHERE 
	date(c.EXTRACT_FILE_DATE) = date(CURRENT_DATE() )
	AND (upper(BILL_FNAME) || ' '||upper(BILL_LNAME) ||' '|| upper(BILL_COMPANY) LIKE '%GDF%'
	OR upper(BILL_FNAME) || ' '||upper(BILL_LNAME) ||' '|| upper(BILL_COMPANY) LIKE '%GUYANA DEFENCE FORCE%')