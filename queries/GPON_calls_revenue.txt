SELECT
    CD.TRANS_DT,
    CD.EXTERNAL_ID,
    CD.POINT_ORIGIN,
    CD.POINT_TARGET,
    CD.PRIMARY_UNITS,
    CD.AMOUNT / 100 AS AMOUNT,
    CD.TOTAL_TAX / 100 AS TAX,
    CD.CHARGED_AMOUNT / 100 AS CHARGED_AMOUNT,
    CD.AUT_ID,
    AFV.DISPLAY_VALUE,
    REPLACE(NVL(AFV.DESCRIPTION,''),'Voice_GPON_','') AS CALL_TYPE
FROM CDR_DATA CD
    JOIN AUT_FINAL_VALUES AFV
    ON AFV.AUT_ID = CD.AUT_ID
    AND AFV.RESELLER_VERSION_ID = (SELECT MAX(RESELLER_VERSION_ID) FROM AUT_FINAL_VALUES)
WHERE DATE(CD.TRANS_DT) BETWEEN ${begin_dt}::DATE AND ${end_dt}::DATE
AND CD.EXTERNAL_ID_TYPE = 37
AND CD.PRIMARY_UNITS > 0
--LIMIT 100