SELECT 
	CD.ACCOUNT_NO 
	,CD.EXTERNAL_ID 
	,max(CD.TRANS_DT) OVER 
	  			(PARTITION BY CD.ACCOUNT_NO ,CD.EXTERNAL_ID ORDER BY CD.TRANS_DT 
	  			RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
	  			) AS Last_recharge_date
FROM 
	GTT_REPORTING.CDR_DATA CD
WHERE 
	CD.EXTERNAL_ID_TYPE=1
	AND DATE(CD.TRANS_DT) >= ADD_MONTHS(current_date, -6)
	AND CD.CHARGED_AMOUNT > 0