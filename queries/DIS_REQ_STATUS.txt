SELECT 
	C.ACCOUNT_NO ,
	E.EXTERNAL_ID ,
	C.BILL_FNAME ,
	C.BILL_LNAME ,
	C.BILL_COMPANY ,
	C.BILL_ADDRESS1 ,
	C.BILL_ADDRESS2 ,
	C.BILL_ADDRESS3 ,
	C.BILL_ADDRESS4 ,
	C.BILL_CITY ,
	C.CONTACT1_PHONE,
	C.CONTACT2_PHONE, 
	C.CUST_EMAIL,
	CASE
     WHEN E.EXTERNAL_ID_TYPE = 9 THEN 'Landline'
       WHEN E.EXTERNAL_ID_TYPE = 11 THEN 'DSL'
         WHEN E.EXTERNAL_ID_TYPE = 1 THEN 'Mobile'
         WHEN E.EXTERNAL_ID_TYPE = 27 THEN 'Leased Line'
       WHEN E.EXTERNAL_ID_TYPE in (37,39) THEN 'Blaze'
       ELSE 'Unknown'
  END SERVICE,
	round(AB.TOTAL /100, 2) AS balance_due
FROM

ATNI_PROD.GTT_REPORTING.CMF_EXTRACT  C
LEFT JOIN ATNI_PROD.GTT_REPORTING.EXTERNAL_ID_EQUIP_MAP_EXTRACT E
	       ON E.ACCOUNT_NO = C.ACCOUNT_NO  AND date(C.EXTRACT_FILE_DATE) = date(CURRENT_DATE()) AND date(E.EXTRACT_FILE_DATE) = date(CURRENT_DATE())
LEFT JOIN ATNI_PROD.GTT_REPORTING.AGED_BALANCES_EXTRACT AB ON C.ACCOUNT_NO = AB.ACCOUNT_NO AND date(AB.EXTRACT_FILE_DATE) = date(CURRENT_DATE())	       
WHERE 
	C.ACCOUNT_STATUS > 0
	AND AB.TOTAL =< 0
	AND E.EXTERNAL_ID_TYPE in (9,11,37,39)
	AND E.IS_CURRENT = 1
	       
