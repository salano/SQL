		SELECT
LAST_DAY(DATESTART) AS REPORT_MONTH,
(SUM(NET_DEACTIVATIONS)/SUM(BEGINNING_ACTIVE))*100 AS CHRUN_RATE,
SUM(NET_DEACTIVATIONS) AS CHURN_TOTAL,
SUM(BEGINNING_ACTIVE) AS BEGINNING_ACTIVE,
SUM(CASE
WHEN DATE_TRUNC('MONTH', DATESTART)=DATE_TRUNC('MONTH', CURRENT_DATE) THEN BEGINNING_ACTIVE + NET_ACTIVATIONS
ELSE
ENDING_ACTIVE
END) AS ENDING_ACTIVE
FROM
ATNI_PROD.ATNI_ANALYTICS.SV_SUBSCRIBER_BG_END_WEEKLY_MONTHLY_SNAPSHOT_DAILYACTIVITY
WHERE
SOURCESYSTEMID=1
AND SUBLINE_OF_SERVICE_SEGMENT='GPON'
AND UNIT_COUNTABLE=1
AND REVENUE_COUNTABLE=1
AND DATASET_TYPE IN('BG_MONTHLY_SNAPSHOT', 'END_MONTHLY_SNAPSHOT', 'DAILY_SUB_ACTIVITY')
GROUP BY 1