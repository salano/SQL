SELECT 
	distinct
	sub.*,
	sub1.*
FROM 
	(
	select 
	  distinct
	  c.ACCOUNT_NO,
	  a.SUBSCR_NO,
	  O.DISPLAY_VALUE,
	  A.ACTIVE_DT AS install_date
	  /*,
	  C.BILL_FNAME,C.BILL_LNAME, C.BILL_COMPANY,
	  C.BILL_ADDRESS1,C.BILL_ADDRESS2, C.BILL_ADDRESS3, C.BILL_ADDRESS4, C.BILL_CITY, C.BILL_STATE, C.BILL_ZIP, C.BILL_COUNTY,
	  C.CUST_EMAIL Email,
	  C.CUST_PHONE1 ,C.CUST_PHONE2,
	  C.CONTACT1_PHONE,C.CONTACT2_PHONE*/
	 
	FROM
			GTT_REPORTING.OFFER_INST A
			INNER JOIN
			GTT_REPORTING.OFFER_VALUES O ON A.OFFER_ID=O.OFFER_ID AND RESELLER_VERSION_ID IN(SELECT MAX(RESELLER_VERSION_ID) FROM GTT_REPORTING.OFFER_VALUES)
			LEFT JOIN
			 GTT_REPORTING.CMF_EXTRACT C ON A.ACCOUNT_NO = C.ACCOUNT_NO
		WHERE
			DATE(A.EFFECTIVE_DT)<=CURRENT_DATE 
	        AND DATE(A.EXPIRY_DT)>CURRENT_DATE
			AND A.INACTIVE_DT IS NULL 
			AND A.OFFER_TYPE in (2,3) -- PRIMARY OFFER
			AND A.ACCOUNT_NO <> 0
			--AND A.OFFER_ID IN  (11166,11167,11186,11425,11426) --New_Residential_SO
			--AND A.OFFER_ID IN (11114,11115,11209) --) Business_SO
			AND A.OFFER_ID IN (11114,11115,11209,11166,11167,11186,11425,11426 )
			AND date(A.ACTIVE_DT) >= DATE_TRUNC('YEAR',CURRENT_DATE())
		ORDER BY 
			c.ACCOUNT_NO
) sub		
		
LEFT JOIN 
(
		SELECT 
			SN.NUMBER,
			account_number,
			CUSTOMER_NAME,
			ADDRESS_1, 
			ADDRESS_2 ,
			CITY ,
			CONTACT_NUMBER_1, 
			CONTACT_NUMBER_2, 
			CONTACT_NUMBER_3 ,
		  SN.STATE,
		  SN.SID,
		  SN.DATE_OF_SALE,
		  SN.PLAN_SELECTED,
		  SN.LCP,
		  GPON_NUMBER,
		  INSTALLED_FSAN,
		  SN.EMAIL SN_EMAIL
		FROM         
		  ATNI_PROD.GTT_REPORTING.GPON_SERVICE_NOW_ORDER_STATUS SN
		WHERE 
				
			DATE(SN.EFFECTIVE_DT)<=CURRENT_DATE 
		    AND DATE(SN.EXPIRY_DT)>CURRENT_DATE
		    AND SN.STATE IN ('Order Complete','Initiate Billing', 'Customer Welcome', 'Truck Roll Complete')
)
sub1 ON sub.account_no = sub1.account_number
ORDER BY 
	sub.account_no,
	sub.SUBSCR_NO,
	sub.DISPLAY_VALUE,
	sub.install_date